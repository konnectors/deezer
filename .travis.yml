language: node_js
node_js:
- '8'
env:
  global:
  - GH_USER_EMAIL="travis@example.org"
  - GH_USER_NAME="cozy-bot"
  - DEPLOY_REPOSITORY="git@github.com:konnectors/deezer.git"
  - secure: q8E9Qv4gQiGD1IG2NZ+MvhFRVYEPtijGUorkB7eyRnoEk3f7YdQVSpELEjM/AKp/St0TVR87u2r8NjSE8BeAq/i9Wer2OF6h8vF09T7gyNx2ysZZzprp+GlExI1++aPfEtY+4llkh88OkJ04R49Kt5RGv2yP2paZAHdrH8tUtJQwIb8T8s2+hapHJ1QqPps+CRFDmHSyPx6Zj61qqhDqzQp/Jw+FvkefGu4On+cNbkvaid9sGUWclHHiXdAziqBkLDcWFSv7jsUR4CIVv9j5upyIwlk1yAlc2UxDFKlrHT36bv3kL2eD76PbGy5vUlbQoK5Pmo7TioTjFcWMozJ0p1DyBg2g37k9TUNN92jy7c/JSjknV5MFI5NGzYE8EQfPuVM7GejiCypBHJXo4PL9Cmq8uiHLbRxwNn1uplWpKwUHqeMNRQC+iZk/K2gBLDaLwZyGbq2r3NEC4v2q3PPdpMuoJP3Ozbc/p9zKYIXDF10cezhoDLE5RZSP5MkgZwvSw3IdeT1b6FnJ34inEdjkwqcuyrZnDgPxz8Iywb+yudwubNKA3l5zVEhZ54PJu1zagLhVpDOxVOSvPhlOascnniMeGkq2dJBCqlzCKSKTH1WakAX+NWin2O2rcPZfNA/qXhLiadmNDxrm7fBnozKYVZgoBLPw8tVMlrjag3BGizY=
cache:
  yarn: true
  directories:
  - node_modules
branches:
  except:
  - build
  - latest
script:
- yarn lint
- yarn build
- yarn run check
deploy:
- provider: script
  skip-cleanup: true
  script: DEPLOY_BRANCH=build yarn deploy && yarn cozyPublish
  on:
    branch: master
- provider: script
  skip-cleanup: true
  script: DEPLOY_BRANCH=build yarn deploy && yarn cozyPublish
  on:
    tags: true
before_install:
- openssl aes-256-cbc -K $encrypted_604ebb0a902d_key -iv $encrypted_604ebb0a902d_iv
  -in github_deploy_key.enc -out /tmp/github_deploy_key -d
- eval "$(ssh-agent -s)"
- chmod 600 /tmp/github_deploy_key
- ssh-add /tmp/github_deploy_key
after_deploy:
- rm /tmp/github_deploy_key
- ssh-add -D
